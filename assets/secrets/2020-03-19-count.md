---
layout: article
title: 计数原理与二项式定理
author: P-Henning
date: 2020-03-19
permalink: /count
license: true
aside:
  toc: true
show_subscribe: true
---

## 计数原理与二项式定理

排列组合计数原理，是用来数数的。怎么数？

- 有条理。例如数下图中线段的条数，可以按左端点来数，也可以按长度来数。
  
  <div align=center><img src="https://s1.ax1x.com/2020/03/16/8tpBfH.png"></div>
  
- 一一映射。
- 递归（数列）。例如平面上$n$个圆最多把平面分成几部分。~~何老板爬楼梯。~~

### 环形染色

一个圆环被分成$n$个格子，有$m$种颜色可以选择。将这些格子染上颜色，要求相邻的格子颜色不能相同。$m$种颜色不必全部使用。有多少种不同的染色方案？

<div align=center><img src="https://s1.ax1x.com/2020/03/16/8tAxZn.png"></div>

**递归：** 考虑格子数从$n-1$变成$n$。可以将第$1$格和第$n-1$格切开，中间加入第$n$格，然后在这个格上染色。由于第$1$格和第$n-1$格颜色不一样，于是第$n$格有$m-2$种颜色可选。此时有$(m-2)a_{n-1}$种方案。

<div align=center><img src="https://s1.ax1x.com/2020/03/16/8tAbRS.png"></div>

但是第$1$格和第$n-1$格颜色是有可能相同的。此时第$1$格和第$n-2$格颜色一定不相同。于是可以从$n-2$变成$n$：加入两个格子，其中第$n-1$格和第$1$格颜色相同，第$n$格就有$m-1$种颜色可选。此时有$(m-1)a_{n-2}$中方案。

<div align=center><img src="https://s1.ax1x.com/2020/03/16/8tAOMQ.png"></div>

于是得出递推式：

$$a_n=(m-2)a_{n-1}+(m-1)a_{n-2}$$

可以发现这是一个二阶线性递推式，用特征方程法可以求出其通项。不过需要知道这个数列的前几项。

毫无争议，$a_2=m(m-1)$。但是要注意的是$a_1=0$。因为这里的$n$实际上并不是格子数，而是隔板数。如果有$1$个隔板，无论怎么染色，隔板两边的颜色都相同，所以$a_1=0$。而真正等于$m$的其实是没有隔板的情况，即$a_0$。

<div align=center><img src="https://s1.ax1x.com/2020/03/16/8tA7Pf.png"></div>

最后求出通项为

$$a_n=(m-1)(-1)^n+(m-1)^n$$

### 完全错排

传言欧拉有五个女朋友~~（怎么可能）~~。有一天，他给每个女朋友都写了一封信，但是没有一封信装在了正确的信封里。有多少种装信封的方案？

换言之：有$n$个人坐在各自的座位上，让$n$个人之间交换座位，使得每个人都不坐在原来的座位上。有多少种交换座位的方案？

$$a_n=n!\left[\frac 1{2!}-\frac 1{3!}+\frac 1{4!}-\cdots+\frac{(-1)^n}{n!}\right]=n!\sum_{k=0}^n\frac{(-1)^k}{k!}$$

其实后面求和的$k$从$0$开始和从$2$开始都一样。

**递归：** 假设$1$和$k$换座位。此时$1$坐在$k$的位置，$k$坐在$1$的位置，其余的$n-2$个人构成一个完全错排。由于$1$可以和$n-1$个人换座位，此时方案数为$(n-1)a_{n-2}$。

但是$1$坐在$k$的位置时，$k$有可能坐在了其它的座位上。此时做一个一一映射：将$1$和$k$两个人再次交换座位，那么$k$被换回了原来的位置，$1$被换到了$k$现在坐的位置。此时除了$k$以外，其余的$n-1$个人构成了一个完全错排，方案数为$(n-1)a_{n-1}$。

于是得到递推公式：

$$a_n=(n-1)a_{n-2}+(n-1)a_{n-1}$$

两边同时除以$n!$，得

$$\frac{a_n}{n!}=\frac{n-1}{n(n-1)}\cdot\frac{a_{n-2}}{(n-2)
!}+\frac{n-1}n\cdot\frac{a_{n-1}}{(n-1)!}$$

构造$b_n=\frac{a_n}{n!}$，则

$$\begin{aligned}
b_n&=\frac 1n b_{n-2}+\frac{n-1}n b_{n-1}\\
b_n-b_{n-1}&=-\frac 1n(b_{n-1}-b_{n-2})
\end{aligned}$$

然后通过累乘求出$b_n-b_{n-1}$，再通过累加求出$b_n$，进而求出$a_n$。

**容斥：** $n$个人随意排列的方案数为$n!$。在这基础上需要减去每个人坐在原来的位置的方案，此时其他$n-1$个人随意排列，方案数为$n\cdot(n-1)!$。再加上至少两个人坐在原来的位置的方案数$C_n^2(n-2)!$。再减去至少三个人坐在原来的位置的方案数$C_n^3(n-3)!$……

$$\begin{aligned}
a_n&=n!-n\cdot(n-1)!+C_n^2(n-2)!-C_n^3(n-3)!+\cdots+(-1)^nC_n^n\\
&=n!-n!+\frac{n!}{2!}-\frac{n!}{3!}+\cdots+\frac{(-1)^n\cdot n!}{n!}\\
&=n!\left[\frac 1{2!}-\frac 1{3!}+\frac 1{4!}-\cdots+\frac{(-1)^n}{n!}\right]
\end{aligned}$$

**补充：泰勒展开**

$$e^x=1+x+\frac{x^2}{2!}+\frac{x^3}{3!}+\cdots=\sum_{k=0}^{+\infty}\frac{x^k}{k!}$$

令$x=-1$，就可以得到

$$\lim_{n\rightarrow +\infty}\sum_{k=0}^n\frac{(-1)^k}{k!}=\frac 1e$$

所以当$n$特别大时，$a_n$可以直接取$\left\lfloor\frac{n!}e\right\rfloor$。

### 卡特兰数

卡特兰数描述的是一个进出栈的问题。~~（吐槽老师栈字不会写）~~

一些等价的问题：

- $n$个人上下车的顺序的方案数。在任何时刻车上的人数大于等于$0$，即总上车人数大于等于总下车人数。
- 老奶奶买冰棍问题。
- $n$个左括号和$n$个右括号的合法排列数。

$$C_n=\frac 1{n+1}C_{2n}^n$$

**一一映射：** $n$个左括号和$n$个右括号的总排列数为$C_{2n}^n$（$2n$个位置中选$n$个位置放左括号，其余位置放右括号）。然后需要减去不合法的排列数。

对于任意一个不合法的括号序列，找到第一个不合法的位置：

$$(\quad)\quad(\quad)\color{Red}{\quad)}\quad(\quad(\quad)$$

将该位置之后的括号进行变换（左括号变成右括号，右括号变成左括号）：

$$(\quad)\quad(\quad)\color{Red}{\quad)\quad)\quad)\quad(}$$

由于该位置之前的左右括号数目一定相等，且该位置一定是右括号，那么变换后左括号数会减少$1$，右括号数会增加$1$，即有$n-1$个左括号、$n+1$个右括号。

反过来，$n-1$个左括号和$n+1$个右括号组成的序列一定是不合法的。找出第一个不合法的位置，同样将之后的括号进行变换，则左右括号的数目又回到$n$，并且得到的括号序列一定不合法。于是$n$个左括号、$n$个右括号的不合法排列与$n-1$个左括号、$n+1$个右括号的所有排列之间一一对应，两者数目应该相等，为$C_{2n}^{n-1}$。

于是

$$\begin{aligned}
C_{2n}^n-C_{2n}^{n-1}&=C_{2n}^n-\frac{(2n)!}{(n-1)!(n+1)!}\\
&=C_{2n}^n-\frac{(2n)!}{n!\cdot n!}\cdot\frac n{n+1}\\
&=\frac 1{n+1}C_{2n}^n
\end{aligned}$$

### 基本例题

**例：** 在一个被分成五个完全相同的部分的环形区域中栽种$3$种植物，要求同一区域中只种$1$种植物，相邻两区域所种植物不同，则不同的栽种方案的总数为（）

<div align=center><img src="https://s1.ax1x.com/2020/03/17/8dniaF.png"></div>

- [ ] A. $21$
- [ ] B. $24$
- [ ] C. $30$
- [ ] D. $48$

$n=5,m=3$，直接套通项公式？并不。$5$个区域地位对等，$3$种植物地位对等，答案一定是$3$和$5$的公倍数，选C。~~白给题。~~

如果是填空题，再直接套公式？并不。在本题中，$3$种植物都必须使用，并且有一种植物只使用了一次，另外两种植物间隔排列，类似下图的情况。

<div align=center><img src="https://s1.ax1x.com/2020/03/17/8dnPVU.png"></div>

选择一个区域栽种只使用一次的植物，方案数为$5$；选择一种植物只使用一次，方案数为$3$；其余两种颜色的染色方案数为$2$。$5\times 3\times 2=30$。~~妙不可言。~~

**例：** （2016清华领军）设$A_1A_2\cdots A_{2016}$是正$2016$边形，从这$2016$个顶点中选出若干个使之能作为正多边形的顶点，则不同的选法共有（）

- [ ] A. $2520$种
- [ ] B. $3528$种
- [ ] C. $4536$种
- [ ] D. $6552$种

考虑所有可能的正多边形的个数：

- $3$边形：$\frac{2016}3$个。
- $4$边形：$\frac{2016}4$个。
- ……
- $1008$边形：$\frac{2016}{1008}$个。
- $2016$边形：$\frac{2016}{2016}$个。

容易发现答案就是$2016$的所有约数之和减去$\frac{2016}1$和$\frac{2016}2$。问题来了，如何求一个数的所有约数之和？

**补充：所有约数之和**

$$n=p_1^{r_1}p_2^{r_2}\cdots p_k^{r_k}$$

其中$p_1,\dots,p_k$为不同质数，$r_1,\dots,r_k\in\mathbb N^{\ast}$。则$n$的所有约数之和为

$$\begin{aligned}
&\left(1+p_1+\cdots+p_1^{r_1}\right)\left(1+p_2+\cdots+p_2^{r_2}\right)\cdots\left(1+p_k+\cdots+p_k^{r_k}\right)\\
=&\frac{p_1^{r_1+1}-1}{p_1-1}\cdot\frac{p_2^{r_2+1}-1}{p_2-1}\cdots\frac{p_k^{r_k+1}-1}{p_k-1}
\end{aligned}$$

将$2016$分解质因数：

$$2016=2^5\times 3^2\times 7$$

所以本题的答案为

$$\begin{aligned}
&\frac{2^6-1}1\cdot\frac{3^3-1}{3-1}\cdot\frac{7^2-1}{7-1}-\frac{2016}1-\frac{2016}2\\
=&63\times 13\times 8-2016-1008\\
=&3528
\end{aligned}$$

**例：** 三个互异的数$a,b,c$相乘时可以有不同的相乘方法，如$(ab)c$、$(ba)c$、$c(ab)$、$b(ca)$就是其中$4$种不同的相乘方法。设$n$个互异数的不同相乘方法共有$I_n$种，则（）

- [ ] A. $I_2=2$
- [ ] B. $I_3=12$
- [ ] C. $I_4=96$
- [ ] D. $I_4=120$

遇事不决找规律。对于三个数相乘，如果只考虑括号的位置，有$(ab)c$、$a(bc)$两种，然后三个数的位置可以交换，因此$I_3=2\times 3!=12$，选项C正确。对于四个数相乘，括号的位置有$((ab)c)d$、$(ab)(cd)$、$(a(bc))d$、$a((bc)d)$、$a(b(cd))$五种，同理有$I_4=5\times 4!$。

括号的位置数与卡特兰数有关系，$C_2=2,C_3=5$。怎么理解？如果把每种相乘方法都加上一个大括号，如$(((ab)c)d)$，则每一对括号都表示一次将两个数相乘的运算。不同的运算顺序就对应了不同的括号排列方式。

$$I_n=n!\cdot C_{n-1}$$

**例：** 求证：$\forall n\in\mathbb N^{\ast}$，$\left(\sqrt 2+1\right)^n$都能写成$\sqrt m+\sqrt{m-1},m\in\mathbb N^{\ast}$的形式。例如$\left(\sqrt 2+1\right)^2=\sqrt 9+\sqrt 8$。

根据二项式定理，$\left(\sqrt 2+1\right)^n=A+B\sqrt 2,A,B\in\mathbb N^{\ast}$。因此需证明$A^2-\left(B\sqrt 2\right)^2=\pm 1$。

由于有

$$\begin{aligned}
\left(1+\sqrt 2\right)^n=A+B\sqrt 2\\
\left(1-\sqrt 2\right)^n=A-B\sqrt 2
\end{aligned}$$

两式相乘，得

$$A^2-\left(B\sqrt 2\right)^2=\left(1+\sqrt 2\right)^n\cdot\left(1-\sqrt 2\right)^n=(-1)^n$$
